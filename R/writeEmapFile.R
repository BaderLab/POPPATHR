#' Write enrichments file for use in Cytoscape EnrichmentMap
#'
#' @param resEmF (list) file paths to results_forEM.txt for each population comparison
#' 		(generated by setupGSEA_run.R).
#' @param enrichNES (integer) NES cutoff to select validated selection-enriched
#'		pathways (default=0.3)
#' @param outF (char) name of output file.

#' @return none. Output file write into directory of first population comparison.
#'    E.g., CEU_YRI directory
#' @export
#'

writeEmapFile <- function(resEmF, enrichNES=0.3, outF) {
  # Read in GSEA results files formatted for EnrichmentMap and combine
  EMfiles <- lapply(resEmF, function(x) read.delim(x, h=TRUE, as.is=TRUE))
  colnames(EMfiles[[1]])[3:5] <- paste(colnames(EMfiles[[1]])[3:5], "1", sep="_")
  colnames(EMfiles[[2]])[3:5] <- paste(colnames(EMfiles[[2]])[3:5], "2", sep="_")
  EMcomb <- join_all(EMfiles, by=c("Geneset", "Description"))
  # Select for enriched pathways
  EMcomb_enrich <- filter(EMcomb, NES_1 >= enrichNES & NES_2 >= enrichNES)
  # Remove gene set annotation details from Description column
  EMcomb_enrich$Description <- gsub("\\%.*", "", EMcomb_enrich$Description)
  # Write out file for EnrichmentMap input
  EMout <- EMcomb_enrich[,c(1:4)]
  write.table(EMout, outF, col=TRUE, row=FALSE, quote=FALSE, sep="\t")
}
